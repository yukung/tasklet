# -- SQL Definition --
sqltable.findUserByUserName            = SELECT * FROM users WHERE user_name = ?
sqltable.findUserByUserNameAndPassword = SELECT * FROM users WHERE user_name = ? AND password = ?
sqltable.isRegistered                  = SELECT COUNT(*) as user_count FROM users WHERE user_name = ?
sqltable.registerUser                  = INSERT INTO users (user_name, email, password, display_name, created_on, updated_on) VALUES (?,?,?,?,CURRENT_TIMESTAMP,CURRENT_TIMESTAMP)
sqltable.registerCategoryDefault       = INSERT INTO categories(user_id, name, created_on, updated_on) VALUES (?, '\u672a\u5206\u985e', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
sqltable.findActivitiesByUserId        = SELECT activities.id ,activities.title ,activities.description ,activities.seq ,categories.name ,indexes.is_incomplete ,activities.created_on ,activities.updated_on FROM indexes ,activities ,categories WHERE indexes.activity_id = activities.id AND indexes.category_id = categories.id AND indexes.user_id = ? AND categories.user_id = ? AND indexes.is_incomplete = true ORDER BY activities.seq DESC LIMIT ? OFFSET ?
sqltable.findTasksByActivityId         = SELECT tasks.id, tasks.activity_id, title, priority, status, period, finished_on, estimated_time, actual_time, tasks.created_on, tasks.updated_on, memo_count FROM tasks, indexes, (SELECT tasks.id, COUNT(memos.id) AS memo_count FROM tasks LEFT OUTER JOIN memos ON tasks.id = memos.task_id WHERE tasks.activity_id = ? GROUP BY tasks.id) AS tmp_memo WHERE tasks.activity_id = indexes.activity_id AND indexes.activity_id = ? AND tasks.id = tmp_memo.id ORDER BY priority ASC, status ASC, period ASC
sqltable.getMaxSequenceOfActivities    = SELECT MAX(seq) AS max_seq FROM indexes, activities WHERE user_id = ? AND activity_id = activities.id
sqltable.addActivityToActivities       = INSERT INTO activities(title, description, seq, created_on, updated_on) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
sqltable.addActivityToIndexes          = INSERT INTO indexes(user_id, category_id, activity_id, is_incomplete, created_on, updated_on) VALUES (?, ?, ?, TRUE, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
sqltable.getLastActivityId             = SELECT MAX(id) as last_activity_id FROM activities WHERE title = ?
sqltable.getLastCategoryId             = SELECT MAX(id) as last_category_id FROM categories WHERE user_id = ?
sqltable.getActivityCountByUserId      = SELECT COUNT(activity_id) AS activities_count FROM indexes WHERE user_id = ?
sqltable.getActivityTitle              = SELECT title FROM activities WHERE id = ?
sqltable.addTaskToTasks                = INSERT INTO tasks(activity_id, title, priority, status, period, estimated_time, created_on, updated_on) VALUES (?, ?, ?, 0, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
sqltable.getTaskDetailAndMemos         = SELECT tasks.id AS id, activity_id, title, priority, status, period, finished_on, estimated_time, actual_time, memos.id AS memo_id, task_id, seq, contents FROM tasks LEFT OUTER JOIN memos ON tasks.id = memos.task_id WHERE tasks.id = ? ORDER BY seq ASC
sqltable.updateTaskByTaskId            = UPDATE tasks SET actual_time = ?, updated_on = CURRENT_TIMESTAMP WHERE id = ?
sqltable.getMaxSequenceOfMemos         = SELECT MAX(seq) AS max_seq FROM memos, tasks WHERE task_id = ? AND task_id = tasks.id
sqltable.addMemoToMemos                = INSERT INTO memos(task_id, seq, contents, created_on, updated_on) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
sqltable.getActivityIdByTaskId         = SELECT activity_id FROM tasks WHERE id = ?